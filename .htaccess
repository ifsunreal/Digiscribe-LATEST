# Route /api/* → PHP reverse-proxy → Node.js on port 25264
# SPA fallback → index.html for React Router

# Tell Passenger to use the shim instead of the bare NVM binary.
# The shim sources NVM and locates the correct node binary at runtime,
# avoiding "Can't execute /home/.nvm/.../bin/node" errors on cPanel hosts.
PassengerNodejs /home/www/devteam2026/node_shim.sh

<IfModule mod_rewrite.c>
  RewriteEngine On

  # Skip rewriting for real files & directories
  # Forward /api/* to the PHP proxy (which curls to Node.js internally)
  RewriteCond %{REQUEST_URI} ^/api/ [NC]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule ^api/(.*)$ /api/index.php?__path=/api/$1 [L,QSA]

  # SPA fallback — serve index.html for React Router
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_URI} !^/api/ [NC]
  RewriteRule ^ /index.html [L]
</IfModule>

# Fallback if mod_rewrite is not available
<IfModule !mod_rewrite.c>
  FallbackResource /index.html
</IfModule>
